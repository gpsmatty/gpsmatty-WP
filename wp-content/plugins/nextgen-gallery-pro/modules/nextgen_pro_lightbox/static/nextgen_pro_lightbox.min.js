!function(e){"use strict";function t(){var t={debug:!1,debug_level:1,state:{slug:null,gallery_id:null,image_id:null,sidebar:null},selector:nextgen_lightbox_filter_selector(e,e(".nextgen_pro_lightbox")),options:{},defaults:{speed:"medium",initial_url:window.location.toString().split("#")[0],ajax_url:photocrati_ajax.url,router_slug:"gallery"},init:function(i){t.methods.log("nplModal.init()",{parameters:i,defaults:t.defaults,selector:t.selector,debug:t.debug,debug_level:t.debug_level});var n=e("<div id='npl_overlay'></div>"),l=e("<div id='npl_wrapper'></div>"),a=e("<div id='npl_spinner_container' class='npl-loading-spinner hidden'><i id='npl_spinner' class='fa fa-spin fa-spinner'></i></div>"),o=e("<div id='npl_button_close' class='hidden'><i class='fa fa-times-circle'></i></div>"),s=e("<div id='npl_content'></div>"),r=e("<div id='npl_sidebar'></div>"),d=e("<div id='npl_sidebar_overlay'><i class='fa fa-spin fa-spinner'/></div>"),g=e("<i   id='npl_sidebar_toggle' class='fa fa-arrow-circle-right'/>");t.methods.mobile.browser.ios()&&(n.addClass("npl_ios_no_opacity"),l.addClass("npl_ios_hack")),t.methods.is_ie9()&&l.addClass("npl_ie9_flex_hack"),e(window).trigger("override_nplModal_methods",t.methods),n.css({background:t.methods.get_setting("background_color")}),a.css({color:t.methods.get_setting("icon_color")}),o.css({color:t.methods.get_setting("overlay_icon_color")}),r.css({background:t.methods.get_setting("sidebar_background_color")}),g.css({color:t.methods.get_setting("overlay_icon_color")});var _=e("body");if(_.append(n),_.append(l),l.append(a),l.append(o),l.append(g),l.append(s),l.append(r),l.append(d),i=e.extend(i,{router_slug:t.methods.get_setting("router_slug")}),t.options=e.extend(t.defaults,i),t.methods.bind_images(),t.methods.set_events(),t.methods.mobile.init(),parseInt(t.methods.get_setting("padding","0"))>0){var c=t.methods.get_setting("padding","0")+t.methods.get_setting("padding_unit","px");e("<style type='text/css'>#npl_wrapper.npl_open_with_padding {top: "+c+";bottom: "+c+";left: "+c+";right: "+c+"; } </style>").appendTo("head")}t.methods.router.routes.push({re:new RegExp("^"+t.options.router_slug+"/(.*)/(.*)/(.*)$","i"),handler:t.methods.url_handler}),t.methods.router.routes.push({re:new RegExp("^"+t.options.router_slug+"/(.*)/(.*)$","i"),handler:t.methods.url_handler}),t.methods.router.routes.push({re:new RegExp("^"+t.options.router_slug+"$","i"),handler:t.methods.close_modal}),t.methods.router.routes.push({re:"",handler:t.methods.close_modal}),t.methods.router.listen(),(t.methods.mobile.browser.ios()||t.methods.mobile.browser.android())&&l.addClass("npl_mobile"),t.methods.mobile.browser.any()&&t.methods.mobile.hide_triggers()},methods:{_pre_open_callbacks:[],_is_open:!1,getDPIRatio:function(){var e=1;return void 0!==window.screen.systemXDPI&&void 0!==window.screen.logicalXDPI&&window.screen.systemXDPI>window.screen.logicalXDPI?e=window.screen.systemXDPI/window.screen.logicalXDPI:void 0!==window.devicePixelRatio&&(e=window.devicePixelRatio),t.methods.log("nplModal.getDPIRatio()",{result:e}),e},url_handler:function(){var i=arguments[0],n=arguments[1],l=null;3===arguments.length&&(l=arguments[2],"1"===l&&(l="comments"));var a=this.get_id_from_slug(i);a||(a=i);var o=this.get_state();parseInt(n)===o.image_id&&(n=parseInt(n));var s={gallery_id:a,image_id:n,sidebar:l,slug:i};this.set_state(s),e("#npl_content").trigger("npl_url_handler",[s]),this.is_open()&&a===t.state.gallery_id||this.open_modal(a,n,l)},run_pre_open_lightbox_callbacks:function(e,t){for(var i=0;i<this._pre_open_callbacks.length;i++){var n=this._pre_open_callbacks[i];t=n(e,t)}return t},add_pre_open_callback:function(e){this._pre_open_callbacks.push(e)},get_state:function(){return t.state},set_state:function(e){t.methods.log("nplModal.set_state()",{state:e}),t.state=e},get_setting:function(e,i){var n="";return n="undefined"!=typeof nplModalSettings&&"undefined"!=typeof nplModalSettings[e]&&""!==nplModalSettings[e]?window.nplModalSettings[e]:i,1===n&&(n=!0),0===n&&(n=!1),"1"===n&&(n=!0),"0"===n&&(n=!1),t.methods.log("nplModal.get_setting()",{name:e,result:n},3),n},get_slug:function(i){var n=i;return"undefined"==typeof window.galleries?n:(e.each(galleries,function(e,t){t.slug&&t.ID===i&&(n=t.slug)}),t.methods.log("nplModal.get_slug()",{gallery_id:i,result:n}),n)},open:function(e){t.methods.log("nplModal.open()",{el:e}),this.mobile.browser.any()&&this.fullscreen.enter();var i={show_sidebar:"",gallery_id:"!",image_id:"!",slug:null,revert_image_id:"!",open_the_lightbox:!0};e.data("nplmodal-show-comments")&&(i.show_sidebar="/comments"),e.data("nplmodal-gallery-id")&&(i.gallery_id=e.data("nplmodal-gallery-id")),e.data("nplmodal-image-id")?i.image_id=parseInt(e.data("nplmodal-image-id")):e.data("image-id")?i.image_id=parseInt(e.data("image-id")):"!"===i.gallery_id&&(i.image_id=e.attr("href")),"!"!==i.gallery_id&&(i.slug=this.get_slug(i.gallery_id)),i=this.run_pre_open_lightbox_callbacks(e,i),i.open_the_lightbox&&("!"!==i.gallery_id&&this.get_setting("enable_routing")?(t.methods.router.front_page_pushstate(i.gallery_id,i.image_id),t.methods.set_state({gallery_id:i.gallery_id,image_id:i.image_id,sidebar:i.show_sidebar,slug:i.slug}),this.router.navigate(t.options.router_slug+"/"+i.slug+"/"+i.image_id+i.show_sidebar),"!"!==i.revert_image_id&&(t.state.image_id=i.revert_image_id)):this.open_modal(i.gallery_id,i.image_id,null))},bind_images:function(){for(var i=nextgen_lightbox_filter_selector(e,e(".nextgen_pro_lightbox")),n=[],l=0;l<i.length;l++){var a=i[l];e(a).hasClass("photocrati_lightbox_always")||e(a).hasClass("decoy")||n.push(a)}t.selector=e(n),t.selector.on("click",function(i){e.inArray(e(this).attr("target"),["_blank","_parent","_top"])>-1||e(this).data("src")&&e(this).data("src").indexOf(t.methods.get_setting("router_slug")+"/image")!==-1&&!e(this).data("nplmodal-gallery-id")||(i.stopPropagation(),i.preventDefault(),i.handled!==!0&&(i.handled=!0,t.methods.open(e(this))))})},set_events:function(){var t=this;e(window).on("refreshed",t.bind_images),e(window).bind("keydown",t.handle_keyboard_input),e(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",t.fullscreen.event_handler),e("#npl_content").bind("npl_images_ready",t.open_modal_final),e("#npl_overlay, #npl_button_close").on("touchstart click",function(e){e.stopPropagation(),e.preventDefault(),e.handled!==!0&&(e.handled=!0,t.close_modal())})},open_modal:function(i,n,l){t.methods.log("nplModal.open_modal()",{gallery_id:i,image_id:n,sidebar:l}),this._is_open=!0,e("html, body").toggleClass("nextgen_pro_lightbox_open"),t.state.image_id=n,t.state.gallery_id=i,e("#npl_spinner_container").removeClass("hidden"),e("#npl_button_close").removeClass("hidden"),this.fullsize.exit(),this.mobile.open(),t.methods.fetch_images.fetch_images(i,n)},open_modal_final:function(i,n){var l=0,a=t.methods.getDPIRatio()>1,o=t.methods.fetch_images.gallery_image_cache[t.state.gallery_id],s=t.state.sidebar;e.each(o,function(e,i){parseInt(t.state.image_id)===parseInt(i.image_id)&&(l=e),"undefined"!=typeof i.full_use_hdpi&&(a&&i.full_use_hdpi?i.image=i.full_srcsets.hdpi:i.image=i.full_image)});var r=t.methods.get_setting("enable_carousel","always"),d=t.methods.get_setting("carousel_thumbnails_limit",250),g=t.methods.get_gallery_from_id(n);"always"===r?r="lazy":"never"===r?r=!1:"nomobile"===r&&(r=!t.methods.mobile.browser.any()&&"lazy"),g&&g.images_list_count>=d&&(r=!1),r||e("#npl_wrapper").addClass("nggpl-carousel-hidden"),!t.methods.mobile.browser.any()&&(s||t.methods.get_setting("display_cart",!1)&&t.methods.get_displayed_gallery_setting(n,"is_ecommerce_enabled",!1)||t.methods.get_setting("display_comments",!1)&&t.methods.get_setting("enable_comments",!1))&&e("#npl_wrapper").addClass("npl-sidebar-open npl-sidebar-overlay-open"),t.methods.get_setting("display_captions",!1)&&e("#npl_wrapper").addClass("npl-info-open"),t.methods.get_setting("style")&&e("#npl_wrapper").addClass("npl-variant-"+t.methods.get_setting("style")),o.length>=d&&(r=!1),t.methods.log("nplModal.open_modal() about to invoke Galleria.run()",{thumbnails:r,images:o,show:l,sidebar:s}),Galleria.run("#npl_content",{responsive:!0,thumbQuality:!1,thumbnails:r,preload:4,theme:"nextgen_pro_lightbox",dataSource:o,show:l,variation:"nggpl-variant-"+t.methods.get_setting("style",""),transition:t.methods.get_setting("transition_effect","slide"),touchTransition:t.methods.get_setting("touch_transition_effect","slide"),imagePan:t.methods.get_setting("image_pan",!1),pauseOnInteraction:t.methods.get_setting("interaction_pause",!0),imageCrop:t.methods.get_setting("image_crop",!0),transitionSpeed:1e3*t.methods.get_setting("transition_speed",.4),nggSidebar:s})},mobile:{meta:null,original:null,adjust:!0,ontouch:"ontouchstart"in window,init:function(){this.ontouch||(this.adjust=!1);var e=window.document;e.querySelector&&(this.meta=e.querySelector("meta[name=viewport]"),this.original=this.meta&&this.meta.getAttribute("content"))},open:function(){this.adjust&&this.meta&&(t.methods.log("nplModal.mobile.open()"),this.meta.setAttribute("content",this.original+", width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=0, shrink-to-fit=no"))},close:function(){this.adjust&&this.meta&&(t.methods.log("nplModal.mobile.close()"),this.meta.setAttribute("content",this.original))},browser:{any:function(){return t.methods.mobile.browser.android()||t.methods.mobile.browser.ios()||t.methods.mobile.browser.windowsphone()||t.methods.mobile.browser.blackberry()},android:function(){return/Android/i.test(navigator.userAgent)},ios:function(){return/crios|iP(hone|od|ad)/i.test(navigator.userAgent)},windowsphone:function(){return/(iemobile|Windows Phone)/i.test(navigator.userAgent)},blackberry:function(){return/(blackberry|RIM Tablet|BB10; )/i.test(navigator.userAgent)}},hide_triggers:function(){e(".ngg-trigger").each(function(){var t=e(this);(t.hasClass("fa-comment")||t.hasClass("fa-shopping-cart"))&&t.hide()})}},is_ie9:function(){return navigator.appVersion.indexOf("MSIE 9.")!==-1},close_modal:function(){if(this._is_open){t.methods.log("nplModal.close_modal()");var i=e("#npl_content");i.trigger("npl_closing"),this.fullsize.enter(),this.fullscreen.exit(),e("#npl_spinner_container, #npl_button_close").addClass("hidden"),e("html, body").toggleClass("nextgen_pro_lightbox_open"),this.mobile.close(),i.data("galleria").destroy(),this.get_setting("enable_routing")&&(history.pushState?history.pushState("",document.title,window.location.pathname+window.location.search):window.location.hash="",this.get_setting("is_front_page")&&history.pushState&&history.pushState({},document.title,t.options.initial_url)),this._is_open=!1}},fullsize:{_is_fullsize:!1,active:function(){return this.fullsize._is_fullsize},enter:function(){t.methods.log("nplModal.fullsize.enter()"),e("#npl_wrapper").removeClass("npl_open_with_padding"),this._is_fullsize=!0},exit:function(){t.methods.log("nplModal.fullsize.exit()"),parseInt(t.methods.get_setting("padding","0"))>0&&!t.methods.mobile.browser.ios()&&e("#npl_wrapper").addClass("npl_open_with_padding"),this._is_fullsize=!1},toggle:function(){t.methods.log("nplModal.fullsize.toggle()"),this.fullsize._is_fullsize?this.fullsize.exit():this.fullsize.enter(),e(window).trigger("resize")}},fullscreen:{enter:function(){t.methods.log("nplModal.fullscreen.enter()");var e=document.getElementById("npl_wrapper");e.requestFullScreen?e.requestFullScreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},exit:function(){t.methods.log("nplModal.fullscreen.exit()"),document.cancelFullScreen?document.cancelFullScreen():document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},toggle:function(){t.methods.log("nplModal.fullscreen.toggle()"),this.fullscreen.has_support()&&(this.fullscreen.active()?this.fullscreen.exit():this.fullscreen.enter())},event_handler:function(){setTimeout(function(){e.nplModal("fullscreen.active")?e.nplModal("fullsize.enter"):e.nplModal("fullsize.exit")},25)},active:function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement},has_support:function(){var e=!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled);return t.methods.log("nplModal.fullscreen.has_support()",{result:e}),e}},handle_keyboard_input:function(e){t.methods.is_open()&&27===e.which&&t.methods.close_modal()},is_open:function(){return this._is_open},log:function(e,i,n){t.debug&&("undefined"==typeof n&&(n=1),n>t.debug_level||("undefined"==typeof i?console.log("NPL Debug:",e):console.log("NPL Debug:",e,i)))},logging:{enable:function(){console.log("Enabling NextGen Pro Lightbox debugging"),t.debug=!0},disable:function(){console.log("Disabling NextGen Pro Lightbox debugging"),t.debug=!1},set_level:function(e){console.log("Setting NextGen Pro Lightbox debug level to "+e),t.level=parseInt(e)}},fetch_images:{gallery_image_cache:[],ajax_info:[],ajax_interval:null,ajax_delay:1400,is_cached:function(i,n){var l=!1;return e.each(this.gallery_image_cache[i],function(e,t){n===t.image_id&&(l=!0)}),t.methods.log("nplModal.fetch_images.is_cached()",{gallery_id:i,image_id:n,gallery_cache:this.gallery_image_cache[i],found:l},4),l},fetch_images:function(i,n){t.methods.log("nplModal.fetch_images.fetch_images() beginning");var l=this;this.ajax_delay=t.methods.get_setting("ajax_delay",1400),"undefined"==typeof this.gallery_image_cache[i]&&(this.gallery_image_cache[i]=[]);var a=t.methods.get_gallery_from_id(i);return null===a?this.fetch_non_ngg_images(i):this.gallery_image_cache[i].length===a.images_list_count?e("#npl_content").trigger("npl_images_ready",[i]):(e.each(a.images_list,function(e,t){l.is_cached(i,t.image_id)||l.gallery_image_cache[i].push(t)}),this.gallery_image_cache[i].length===a.images_list_count?e("#npl_content").trigger("npl_images_ready",[i]):this.gallery_image_cache[i].length<a.images_list_count?this.fetch_images_from_ajax(i):void 0)},fetch_non_ngg_images:function(i){t.methods.log("nplModal.fetch_images.fetch_non_ngg_images() beginning",{gallery_id:i});var n=this;t.selector.each(function(){var l=e(this);if(l.hasClass("ngg-trigger"))return!0;if("!"!==i&&i!==l.data("nplmodal-gallery-id"))return!0;if(i!==t.methods.get_state().gallery_id)return!0;if("!"===t.methods.get_state().gallery_id&&l.data("nplmodal-gallery-id"))return!0;var a=e(this).find("img").first(),o={},s=/\.(jpeg|jpg|gif|png|bmp)$/i;if(o.image=void 0===l.data("fullsize")?l.attr("href"):l.data("fullsize"),"undefined"!=typeof o.image&&!o.image.match(s)&&a.attr("srcset")){var r=parseSrcset(a.attr("srcset")),d=0;_.each(r,function(e){void 0!==typeof e.w&&e.w>d&&(d=e.w,o.image=e.url)})}return o.image.match(s)||(o.image=a.attr("src")),o.image_id=void 0===l.data("image-id")?o.image:l.data("image-id"),!!n.is_cached(i,o.image_id)||(void 0!==l.data("thumb")?o.thumb=l.data("thumb"):"undefined"!==l.data("thumbnail")&&(o.thumb=l.data("thumbnail")),void 0!==l.data("title")?o.title=l.data("title"):"undefined"!=typeof a.attr("title")?o.title=a.attr("title"):"undefined"!=typeof l.siblings(".wp-caption-text").html()&&(o.title=l.siblings(".wp-caption-text").html()),void 0!==l.data("description")?o.description=l.data("description"):o.description=a.attr("alt"),void n.gallery_image_cache[i].push(o))}),t.methods.log("nplModal.fetch_images.fetch_non_ngg_images() result",{result:n.gallery_image_cache[i]}),e("#npl_content").trigger("npl_images_ready",[i])},create_deferred_ajax:function(i,n,l){var a=this;return e.ajax({async:!0,url:t.options.ajax_url,method:"POST",data:{id:i,gallery:n,action:"pro_lightbox_load_images",lang:t.methods.get_setting("lang",null),page:l},dataType:"json",success:function(n){t.methods.log("nplModal.fetch_images.create_deferred_ajax() response",{response:n}),e.each(n,function(e,t){a.is_cached(i,t.image_id)||a.gallery_image_cache[i].push(t)})}})},fetch_images_from_ajax:function(n,l){if(t.methods.is_open()){t.methods.log("nplModal.fetch_images.fetch_images_from_ajax()",{gallery_id:n,image_id:l});var a=this,o=t.methods.get_gallery_from_id(n),s=e.extend({},o);delete s.images_list,delete s.display_settings;var r=[];for(i=0;i<=Math.ceil(s.images_list_count/t.methods.get_setting("localize_limit"));i++)r.push(t.methods.fetch_images.create_deferred_ajax(n,s,i));return e.when.apply(e,r).then(function(){e("#npl_content").trigger("npl_images_ready",[n])}),a.gallery_image_cache[n]}}},get_gallery_from_id:function(t){if("undefined"==typeof window.galleries)return null;var i=null;return e.each(galleries,function(e,n){n.ID===t&&(i=n)}),i},get_id_from_slug:function(t){var i=t;return"undefined"==typeof window.galleries?i:(e.each(galleries,function(e,n){n.slug===t&&(i=n.ID)}),i)},get_displayed_gallery_setting:function(e,i,n){var l="",a=this.get_gallery_from_id(e);return l=a&&"undefined"!=typeof a.display_settings[i]?a.display_settings[i]:n,"1"===l&&(l=!0),"0"===l&&(l=!1),1===l&&(l=!0),0===l&&(l=!1),t.methods.log("nplModal.get_displayed_gallery_setting()",{gallery_id:e,name:i,result:l}),l},router:{routes:[],interval:null,listen:function(e){var t=this;e=e||"";var i=function(){e!==t.get_fragment()&&(e=t.get_fragment(),t.match(e))};clearInterval(this.interval),this.interval=setInterval(i,50)},get_fragment:function(e){e=e||window.location.href;var t=e.match(/#(.*)$/),i=t?t[1]:"";return i.toString().replace(/\/$/,"").replace(/^\//,"")},navigate:function(e,t){t=t||!1,t&&clearInterval(this.interval),e=e?e:"",window.location.href.match(/#(.*)$/),window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+e,t&&this.router.listen(this.router.get_fragment())},match:function(e){for(var i=e||this.get_fragment(),n=0;n<this.routes.length;n++){var l=i.match(this.routes[n].re);if(l)return l.shift(),this.routes[n].handler.apply(t.methods,l),this}},front_page_pushstate:function(i,n){if(!t.methods.get_setting("is_front_page")||void 0===i)return!1;if("undefined"==typeof window.galleries)return!1;t.methods.log("beginning nplModal.router.front_page_pushstate()",{gallery_id:i,image_id:n});var l="",a=i;return e.each(galleries,function(e,t){t.ID===i&&"undefined"!=typeof t.wordpress_page_root&&(l=t.wordpress_page_root,t.slug&&(a=t.slug))}),l+="#"+this.get_fragment(t.methods.get_setting("router_slug")+"/"+a+"/"+n),history.pushState?(history.pushState({},document.title,l),!0):(window.location=l,!1)}}}};this.core=t}var n=new t;e.nplModal=function(t){function i(e,t){for(var i=t.split(".");i.length;)e=e[i.shift()];return e}if("undefined"==typeof t)return n.core.init.apply(n,{});if("object"==typeof t)return n.core.init.apply(n,t);var l=i(n.core.methods,t);return l?l.apply(n.core.methods,Array.prototype.slice.call(arguments,1)):void e.error("Method "+t+" does not exist on jQuery.nplModal")}}(jQuery),jQuery(document).ready(function(e){e.nplModal()});