jQuery(function(e){e("#npl_content").on("npl_ready",function(a,t){var n=t.methods,i=t.galleria_theme;log=function(e,a,t){jQuery.nplModal("log",e,a,t)},log("ecommerce initializing"),n.sidebars.cart={init:function(){},render:function(a){log("ecommerce sidebars.cart.render()",{id:a}),e("#npl_wrapper").addClass("npl-sidebar-overlay-open");var t=e("#npl_sidebar");t.empty();var n=new Ngg_Pro_Cart.Views.Add_To_Cart({image_id:a,container:t});n.on("rendered",this.show_licensing_terms),n.on("ready",function(){log("ecommerce sidebars.cart.render() ready"),n.render(),i.trigger("npl_sidebar_rendered")})},show_licensing_terms:function(){log("ecommerce sidebars.cart.show_licensing_terms() beginning");var a={action:"get_digital_download_settings",image_id:this.image_id},t=this.$el.find("#ngg_digital_downloads_header");e.post(parent.photocrati_ajax.url,a,function(a){"object"!=typeof a&&(a=JSON.parse(a)),log("ecommerce sidebars.cart.show_licensing_terms() response",{response:a}),t.html(a.header),e("#npl_wrapper").removeClass("npl-sidebar-overlay-open")})},get_type:function(){return"cart"},events:{bind:function(){log("ecommerce sidebars.cart.events.bind()"),i.bind("npl_init",this.npl_init),i.bind("npl_init_keys",this.npl_init_keys),i.bind("image",this.image),i.bind("loadstart",this.loadstart)},loadstart:function(){log("ecommerce sidebars.cart.events.loadstart()"),e.nplModal("get_state").sidebar&&e.nplModal("get_state").sidebar==n.sidebars.cart.get_type()&&e("#npl_wrapper").addClass("npl-sidebar-overlay-open")},_image_ran_once:!1,image:function(){log("ecommerce sidebars.cart.events.image()"),n.sidebars.cart.events.is_ecommerce_enabled()&&(n.sidebars.cart._image_ran_once?e.nplModal("get_state").sidebar&&e.nplModal("get_state").sidebar==n.sidebars.cart.get_type()&&n.sidebar.render(n.sidebars.cart.get_type()):(e.nplModal("get_state").sidebar&&e.nplModal("get_state").sidebar==n.sidebars.cart.get_type()||e.nplModal("get_setting","display_cart",!1)&&!e.nplModal("get_setting","display_comments",!1))&&!Galleria.TOUCH&&n.sidebar.open(n.sidebars.cart.get_type()),n.sidebars.cart._image_ran_once=!0)},is_ecommerce_enabled:function(){var a=!1,t=e.nplModal("get_gallery_from_id",e.nplModal("get_state").gallery_id);return t&&"undefined"!=typeof t.display_settings.is_ecommerce_enabled&&(a=t.display_settings.is_ecommerce_enabled),t&&"undefined"!=typeof t.display_settings.original_settings&&"undefined"!=typeof t.display_settings.original_settings.is_ecommerce_enabled&&(a=t.display_settings.original_settings.is_ecommerce_enabled),parseInt(a)},npl_init:function(){log("ecommerce sidebars.cart.events.npl_init()");var a=n.sidebars.cart.events.is_ecommerce_enabled;if(a()){var t=e("<i/>").addClass("nggpl-toolbar-button-cart fa fa-shopping-cart").attr({title:ngg_cart_i18n.nggpl_toggle_sidebar}).click(function(e){n.sidebar.toggle(n.sidebars.cart.get_type()),e.preventDefault()});n.thumbnails.register_button(t)}},npl_init_keys:function(a){log("ecommerce sidebars.cart.events.npl_init_keys");var t=n.galleria.get_keybinding_exclude_list();i.attachKeyboard({69:function(){var a=n.sidebars.cart.events.is_ecommerce_enabled;!e(document.activeElement).is(t)&&a()&&n.sidebar.toggle(n.sidebars.cart.get_type())}})}}},n.sidebars.cart.events.bind()}),e(document).on("ngg-caption-add-icons",function(a,t){if(e.nplModal("get_displayed_gallery_setting",t.gallery_id,"is_ecommerce_enabled",!1)){var n=e("<i/>",{class:"fa fa-shopping-cart nextgen_pro_lightbox ngg-caption-icon","data-nplmodal-gallery-id":t.gallery_id,"data-nplmodal-image-id":t.image_id,"data-image-id":t.image_id,"data-nplmodal-show-cart":"1"}).on("click",function(a){return a.preventDefault(),e.nplModal("open",e(this)),!1});t.el.append(n)}})});